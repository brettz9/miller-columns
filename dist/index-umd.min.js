!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).addMillerColumnPlugin=t()}(this,(function(){"use strict";var e="undefined"!=typeof document?document.currentScript:null;function t(e,{before:t,after:n,favicon:r,canvas:o,image:a=!0,acceptErrors:c}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map((e=>function(e){let l,s={};Array.isArray(e)?[l,s={}]=e:l=e;let{favicon:i=r}=s;const{before:d=t,after:u=n,canvas:f=o,image:p=a}=s;function h(){d?d.before(m):u?u.after(m):document.head.append(m)}const m=document.createElement("link");return new Promise(((e,t)=>{let n=t;if(c&&(n="function"==typeof c?n=>{c({error:n,stylesheetURL:l,options:s,resolve:e,reject:t})}:e),l.endsWith(".css")?i=!1:l.endsWith(".ico")&&(i=!0),i){if(m.rel="shortcut icon",m.type="image/x-icon",!1===p)return m.href=l,h(),void e(m);const n=document.createElement("canvas");n.width=16,n.height=16;const r=n.getContext("2d"),o=document.createElement("img");return o.addEventListener("error",(e=>{t(e)})),o.addEventListener("load",(()=>{if(!r)throw new Error("Canvas context could not be found");r.drawImage(o,0,0),m.href=f?n.toDataURL("image/x-icon"):l,h(),e(m)})),void(o.src=l)}m.rel="stylesheet",m.type="text/css",m.href=l,h(),m.addEventListener("error",(e=>{n(e)})),m.addEventListener("load",(()=>{e(m)}))}))}(e))))}
/**
   * MIT License.
   *
   * @copyright 2014 White Magic Software, Inc.
   * @copyright 2018 Brett Zamir
   */const n=new URL("../miller-columns.css","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:e&&"SCRIPT"===e.tagName.toUpperCase()&&e.src||new URL("index-umd.min.js",document.baseURI).href).href;return async function(e,{namespace:r="miller",stylesheets:o=["@default"]}={}){let a;const c=`ul:not(.${r}-no-columns),ol:not(.${r}-no-columns)`,l="li";function s(){return e(`.${r}-column > .${r}-selected`)}function i(t){const n=e(`.${r}-breadcrumbs`).empty();a.breadcrumbRoot&&e(`<span class="${r}-breadcrumb ${r}-breadcrumb-root">`).text(a.breadcrumbRoot).on("click",(function(){t&&h(t)})).appendTo(n),s().each((function(){const t=e(this);e(`<span class="${r}-breadcrumb">`).text(t.text().trim()).on("click",(function(){t.trigger("click")})).appendTo(n)}))}function d(t,n){let o=0;(t?s().not(t):s()).each((function(){o+=e(this).outerWidth(!0)})),n.stop().animate({scrollLeft:o},a.delay,(function(){n.find(`.${r}-column:not(.${r}-collapse)`).last()[0].scrollLeft=o,a.scroll&&a.scroll.call(this,t,n)}))}function u(t,n){const o=[];let a;for(o.push(n||t.children());o.length;)a=o.shift(),a.children(l).each((function(){const n=e(this),a=n.children(c),s=n.parent().parent();s.length&&s.is(l)&&null==n.data(`${r}-ancestor`)&&e(this).siblings().addBack().data(`${r}-ancestor`,s),a.length&&(o.push(a),e(this).data(`${r}-child`,a).addClass(`${r}-parent`)),e(this).parent(c).appendTo(t).addClass(`${r}-column`)}))}function f(){e(`.${r}-column:gt(0)`).addClass(`${r}-collapse`)}function p(){return s().last()}function h(e){m(e,!0),function(e){d(null,e)}(e)}function m(t,n){f(),s().removeClass(`${r}-selected`),i(t),a.reset(t,n),a.preview&&e(`.${r}-preview`).remove()}function $(){const e=p().next();e[0]?.scrollIntoView({block:"nearest",inline:"start"}),e.trigger("click")}function g(t){let n,o="";return function(a){const c=a.key;let s=!1;switch(c){case"Escape":h(t);break;case"ArrowUp":!function(){const e=p().prev();e[0]?.scrollIntoView({block:"nearest"}),e.trigger("click")}(),s=!0;break;case"ArrowDown":$(),s=!0;break;case"ArrowLeft":!function(){const e=p(),t=e.data(`${r}-ancestor`),n=e.data(`${r}-child`);(!n||n.hasClass(`${r}-collapse`)||t)&&t&&(t[0]?.scrollIntoView({block:"nearest"}),t.trigger("click"))}(),s=!0;break;case"ArrowRight":!function(){const e=p().data(`${r}-child`);if(e){const t=e.children(l).first();t[0]?.scrollIntoView({block:"nearest"}),t.trigger("click")}else $()}(),s=!0;break;default:if(!a.metaKey&&!a.altKey){if(1===c.length){!function(e){const t=Date.now();!n||t-n<500?o+=e:o=e,n=t}(c);const a=t.find(`${l}.${r}-selected`).last().siblings().filter((function(){return new RegExp("^"+(t=o,t.replaceAll(/[\-\[\]\{\}\(\)*+?.,\\^$\|#\s]/gv,String.raw`\$&`)),"iv").test(e(this).text().trim());var t})).first();a[0]?.scrollIntoView({block:"nearest"}),a.trigger("click")}s=!0}}s&&0===p().length&&e(`.${r}-column`).first().children().first().trigger("click"),s&&a.preventDefault()}}return o&&await t(o.map((e=>"@default"===e?n:e))),e.fn.millerColumns=function(t){const n={current(e){},reset(e){},preview:null,onPreview:null,breadcrumbRoot:"Root",breadcrumb:i,animation:d,delay:500,outsideClickBehavior:"select-parent"};a=e.extend(n,t);const o=this.each((function(){const t=e(this),n=t.html();t.data(`${r}-original-html`,n),u(t),f(),i(t);const o=g(t);t.on("click",l,(function(n){const o=e(this);m(t,!1);const c=o.data(`${r}-child`);let l=o;for(c&&(c[0]?.scrollIntoView({block:"nearest"}),c.removeClass(`${r}-collapse`).children().removeClass(`${r}-selected`));l;)l.addClass(`${r}-selected`).parent().removeClass(`${r}-collapse`),l=l.data(`${r}-ancestor`);if(a.animation.call(this,o,t),a.breadcrumb.call(this,t),a.current.call(this,o,t),a.preview){if(o.hasClass(`${r}-selected`)&&!o.hasClass(`${r}-parent`)){const n=a.preview.call(this,o,t),c=e(`<ul class="${r}-column ${r}-preview">\n                <li>${n}</li>\n              </ul>`);o.parent().parent().append(c),c[0].scrollIntoView({block:"nearest",inline:"start"}),c.on("click",(e=>{e.stopPropagation(),a.onPreview?.call(this,e,c,t)}))}}n.stopPropagation()})),t[0].addEventListener("keydown",o),t.on("click",(n=>{switch(a.outsideClickBehavior){case"reset":h(t);break;case"select-parent":{const t=document.caretPositionFromPoint(n.clientX,n.clientY),o=t?.offsetNode;let a=1===o?.nodeType?o:o?.parentElement;for(;a;){if(a.matches(`ul.${r}-column:not(.${r}-collapse)`)){e(a).prevAll(`ul.${r}-column:not(.${r}-collapse)`).first().find(`li.${r}-selected`).trigger("click");break}a=a.parentElement}break}}})),t.data(`${r}-keypress-handler`,o)}));return o.addItem=function(t,n){const a="string"==typeof t?e(t):t,l=o;if(n){let t=n.data(`${r}-child`);t?(t.append(a),a.data(`${r}-ancestor`,n)):(t=e("<ul>").append(a),n.append(t),n.data(`${r}-child`,t).addClass(`${r}-parent`),a.data(`${r}-ancestor`,n),u(l,t),t=n.data(`${r}-child`));const o=a.children(c);o.length&&(a.data(`${r}-child`,o).addClass(`${r}-parent`),u(l,o))}else{const t=l.find(`.${r}-column`).first();if(t.length){t.append(a);const e=a.children(c);e.length&&(a.data(`${r}-child`,e).addClass(`${r}-parent`),u(l,e))}else{const t=e("<ul>").append(a);l.append(t),u(l,t)}}return a},o.refreshChildren=function(t,n){if(!t||!t.length)return t;const a=t.data(`${r}-child`);a&&a.length&&(a.remove(),t.removeData(`${r}-child`).removeClass(`${r}-parent`));const c=n.map((t=>"string"==typeof t?e(t):t)),l=e("<ul>").append(c);return t.append(l),u(o,l),t.trigger("click"),t},o.destroy=function(){return o.each((function(){const t=e(this),n=t.data(`${r}-keypress-handler`);n&&this.removeEventListener("keydown",n),t.off("click"),t.find(`.${r}-column`).removeClass(`${r}-column ${r}-collapse`),t.find(`.${r}-parent`).removeClass(`${r}-parent`),t.find(`.${r}-selected`).removeClass(`${r}-selected`),t.find("li").each((function(){const t=e(this);t.removeData(`${r}-ancestor`),t.removeData(`${r}-child`)})),t.find(`.${r}-preview`).remove();const o=t.data(`${r}-original-html`);o&&(t.html(o),t.removeData(`${r}-original-html`)),t.removeData(`${r}-keypress-handler`)})),delete o.addItem,delete o.destroy,delete o.refreshChildren,o},o},e}}));
