!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).addMillerColumnPlugin=t()}(this,(function(){"use strict";function e(e,{before:t,after:n,favicon:c,canvas:s,image:i=!0,acceptErrors:r}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(e=>function(e){let l={};Array.isArray(e)&&([e,l={}]=e);let{favicon:o=c}=l;const{before:a=t,after:d=n,canvas:u=s,image:f=i}=l;function h(){a?a.before(m):d?d.after(m):document.head.appendChild(m)}const m=document.createElement("link");return new Promise((t,n)=>{let c=n;if(r&&(c="function"==typeof r?c=>{r({error:c,stylesheetURL:e,options:l,resolve:t,reject:n})}:t),e.endsWith(".css")?o=!1:e.endsWith(".ico")&&(o=!0),o){if(m.rel="shortcut icon",m.type="image/x-icon",!1===f)return m.href=e,h(),void t(m);const c=document.createElement("canvas");c.width=16,c.height=16;const s=c.getContext("2d"),i=document.createElement("img");return i.addEventListener("error",e=>{n(e)}),i.addEventListener("load",()=>{s.drawImage(i,0,0),m.href=u?c.toDataURL("image/x-icon"):e,h(),t(m)}),void(i.src=e)}m.rel="stylesheet",m.type="text/css",m.href=e,h(),m.addEventListener("error",e=>{c(e)}),m.addEventListener("load",()=>{t(m)})})}(e)))}const t=new URL("node_modules/miller-columns/src/index.js",location),n=new URL("../miller-columns.css",t).href;return async function(t,{namespace:c="miller",stylesheets:s=["@default"]}={}){let i;const r=`ul:not(.${c}-no-columns),ol:not(.${c}-no-columns)`;function l(){return t(`.${c}-column > .${c}-selected`)}function o(){const e=t(`.${c}-breadcrumbs`).empty();l().each((function(){const n=t(this);t(`<span class="${c}-breadcrumb">`).text(n.text().trim()).click((function(){n.click()})).appendTo(e)}))}function a(e,n){let s=0;l().not(e).each((function(){s+=t(this).outerWidth(!0)})),n.stop().animate({scrollLeft:s},i.delay,(function(){n.find(`.${c}-column:not(.${c}-collapse)`).last()[0].scrollLeft=s,i.scroll&&i.scroll.call(this,e,n)}))}function d(){t(`.${c}-column:gt(0)`).addClass(c+"-collapse")}function u(){return l().last()}function f(e){h(e),function(e){a(null,e)}(e)}function h(e){d(),l().removeClass(c+"-selected"),o(),i.reset(e),i.preview&&t(`.${c}-preview`).remove()}function m(){u().next().click()}function p(e){let n,s="";return function(i){const{key:r}=i;let l=!1;switch(r){case"Escape":f(e);break;case"ArrowUp":u().prev().click(),l=!0;break;case"ArrowDown":m(),l=!0;break;case"ArrowLeft":!function(){const e=u().data(c+"-ancestor");e&&e.click()}(),l=!0;break;case"ArrowRight":!function(){const e=u().data(c+"-child");e?e.children("li").first().click():m()}(),l=!0;break;default:if(1===r.length){!function(e){const t=new Date;!n||t-n<500?s+=e:s=e,n=t}(r),e.find(`li.${c}-selected`).last().siblings().filter((function(){return new RegExp("^"+(e=s,e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"i").test(t(this).text().trim());var e})).first().click()}l=!0}l&&0===u().length&&t(`.${c}-column`).first().children().first().click(),l&&i.preventDefault()}}return s&&await e(s.map(e=>"@default"===e?n:e)),t.fn.millerColumns=function(e){const n={current(e){},reset(e){},preview:null,breadcrumb:o,animation:a,delay:500,resetOnOutsideClick:!0};return i=t.extend(n,e),this.each((function(){const e=t(this);!function(e){const n=[];let s;for(n.push(e.children());n.length;)s=n.shift(),s.children("li").each((function(s,i){const l=t(this),o=l.children(r),a=l.parent().parent();a.length&&null==l.data(c+"-ancestor")&&t(this).siblings().addBack().data(c+"-ancestor",a),o.length&&(n.push(o),t(this).data(c+"-child",o).addClass(c+"-parent")),t(this).parent(r).appendTo(e).addClass(c+"-column")}))}(e),d(),e.find("li").on("click",(function(n){const s=t(this);h(e);const r=s.data(c+"-child");let l=s;for(r&&r.removeClass(c+"-collapse").children().removeClass(c+"-selected");l;)l.addClass(c+"-selected").parent().removeClass(c+"-collapse"),l=l.data(c+"-ancestor");if(i.animation.call(this,s,e),i.breadcrumb.call(this),i.current.call(this,s,e),i.preview){if(s.hasClass(c+"-selected")&&!s.hasClass(c+"-parent")){const t=i.preview.call(this,s,e);s.parent().parent().append(`<ul class="${c}-column ${c}-preview">\n                                <li>${t}</li>\n                            </ul>`)}}n.stopPropagation()})),e.on("keydown",p(e)),e.on("click",()=>{i.resetOnOutsideClick&&f(e)})}))},t}}));
