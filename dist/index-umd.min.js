!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.addMillerColumnPlugin=t()}(this,function(){"use strict";const e=new URL("node_modules/miller-columns/src/index.js",location),t=new URL("../miller-columns.css",e).href;return async function(e,{stylesheets:n=["@default"]}={}){let c;const o="ul:not(.no-columns),ol:not(.no-columns)",i="li";function l(){return e(".column > .selected")}function s(){const t=e("div.breadcrumb").empty();l().each(function(){const n=e(this);e("<span>").text(n.text().trim()).click(function(){n.click()}).appendTo(t)})}function r(t,n){let o=0;l().not(t).each(function(){o+=e(this).outerWidth(!0)}),n.stop().animate({scrollLeft:o},c.delay)}function a(){e(".column:gt(0)").addClass("collapse")}function d(){return l().last()}function u(e){f(e),function(e){r(null,e)}(e)}function f(e){a(),l().removeClass("selected"),s(),c.current(null,e)}function h(){d().next().click()}function m(t){let n,c="";return function(o){const{key:l}=o;let s=!1;switch(l){case"Escape":u(t);break;case"ArrowUp":d().prev().click(),s=!0;break;case"ArrowDown":h(),s=!0;break;case"ArrowLeft":!function(){const e=d().data("ancestor");e&&e.click()}(),s=!0;break;case"ArrowRight":!function(){const e=d().data("child");e?e.children(i).first().click():h()}(),s=!0;break;default:1===l.length&&(!function(e){const t=new Date;!n||t-n<500?c+=e:c=e,n=t}(l),t.find("ul:not(.no-columns,.collapse),ol:not(.no-columns,.collapse) > li.selected").last().parent().children().children("*:not(ul:not(.no-columns))").filter(function(){return new RegExp("^"+(t=c,t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"i").test(e(this).text().trim());var t}).first().click()),s=!0}s&&0===d().length&&e(".column").first().children().first().click(),s&&o.preventDefault()}}n&&await function(e,{before:t,after:n,favicon:c,canvas:o,image:i=!0}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(function(e){function l(){t?t.before(s):n?n.after(s):document.head.appendChild(s)}const s=document.createElement("link");return new Promise((t,n)=>{if(e.endsWith(".ico")&&(c=!0),c){if(s.rel="shortcut icon",s.type="image/x-icon",!1===i)return s.href=e,l(),void t(s);const c=document.createElement("canvas");c.width=16,c.height=16;const r=c.getContext("2d"),a=document.createElement("img");return a.addEventListener("error",e=>{n(e)}),a.addEventListener("load",()=>{r.drawImage(a,0,0),s.href=o?c.toDataURL("image/x-icon"):e,l(),t(s)}),void(a.src=e)}s.rel="stylesheet",s.type="text/css",s.href=e,l(),s.addEventListener("error",e=>{n(e)}),s.addEventListener("load",()=>{t(s)})})}))}(n.map(e=>"@default"===e?t:e)),e.fn.millerColumns=function(t){const n={current:e=>{},breadcrumb:s,animation:r,delay:500,resetOnOutsideClick:!0};return c=e.extend(n,t),this.each(function(){const t=e(this);!function(t){const n=[];let c;for(n.push(t.children());n.length;)(c=n.shift()).children(i).each(function(c,i){const l=e(this),s=l.children(o),r=l.parent().parent();r.length&&null==l.data("ancestor")&&e(this).siblings().addBack().data("ancestor",r),s.length&&(n.push(s),e(this).data("child",s).addClass("parent")),e(this).parent(o).appendTo(t).addClass("column")})}(t),a(),t.find(i).on("click",function(n){const o=e(this);f(t);const i=o.data("child");let l=o;for(i&&i.removeClass("collapse").children().removeClass("selected");l;)l.addClass("selected").parent().removeClass("collapse"),l=l.data("ancestor");c.animation.call(this,o,t),c.breadcrumb.call(this),c.current.call(this,o,t),n.stopPropagation()}),t.on("keydown",m(t)),t.on("click",()=>{c.resetOnOutsideClick&&u(t)})})}}});
