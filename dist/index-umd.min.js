!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.addMillerColumnPlugin=t()}(this,function(){"use strict";const e=new URL("node_modules/miller-columns/src/index.js",location),t=new URL("../miller-columns.css",e).href;return async function(e,{namespace:n="miller",stylesheets:c=["@default"]}={}){let s;const r=`ul:not(.${n}-no-columns),ol:not(.${n}-no-columns)`,i="li";function o(){return e(`.${n}-column > .${n}-selected`)}function a(){const t=e(`.${n}-breadcrumbs`).empty();o().each(function(){const c=e(this);e(`<span class="${n}-breadcrumb">`).text(c.text().trim()).click(function(){c.click()}).appendTo(t)})}function l(t,n){let c=0;o().not(t).each(function(){c+=e(this).outerWidth(!0)}),n.stop().animate({scrollLeft:c},s.delay)}function d(){e(`.${n}-column:gt(0)`).addClass(`${n}-collapse`)}function u(){return o().last()}function f(e){h(e),function(e){l(null,e)}(e)}function h(t){d(),o().removeClass(`${n}-selected`),a(),s.reset(t),s.preview&&e(`.${n}-preview`).remove()}function m(){u().next().click()}function p(t){let c,s="";return function(r){const{key:o}=r;let a=!1;switch(o){case"Escape":f(t);break;case"ArrowUp":u().prev().click(),a=!0;break;case"ArrowDown":m(),a=!0;break;case"ArrowLeft":!function(){const e=u().data(`${n}-ancestor`);e&&e.click()}(),a=!0;break;case"ArrowRight":!function(){const e=u().data(`${n}-child`);e?e.children(i).first().click():m()}(),a=!0;break;default:1===o.length&&(!function(e){const t=new Date;!c||t-c<500?s+=e:s=e,c=t}(o),t.find(`${i}.${n}-selected`).last().siblings().filter(function(){return new RegExp("^"+(t=s,t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"i").test(e(this).text().trim());var t}).first().click()),a=!0}a&&0===u().length&&e(`.${n}-column`).first().children().first().click(),a&&r.preventDefault()}}c&&await function(e,{before:t,after:n,favicon:c,canvas:s,image:r=!0,acceptErrors:i}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(function(e){let o={};Array.isArray(e)&&([e,o={}]=e);let{favicon:a=c}=o;const{before:l=t,after:d=n,canvas:u=s,image:f=r}=o;function h(){l?l.before(m):d?d.after(m):document.head.appendChild(m)}const m=document.createElement("link");return new Promise((t,n)=>{let c=n;if(i&&(c="function"==typeof i?c=>{i({error:c,stylesheetURL:e,options:o,resolve:t,reject:n})}:t),e.endsWith(".css")?a=!1:e.endsWith(".ico")&&(a=!0),a){if(m.rel="shortcut icon",m.type="image/x-icon",!1===f)return m.href=e,h(),void t(m);const c=document.createElement("canvas");c.width=16,c.height=16;const s=c.getContext("2d"),r=document.createElement("img");return r.addEventListener("error",e=>{n(e)}),r.addEventListener("load",()=>{s.drawImage(r,0,0),m.href=u?c.toDataURL("image/x-icon"):e,h(),t(m)}),void(r.src=e)}m.rel="stylesheet",m.type="text/css",m.href=e,h(),m.addEventListener("error",e=>{c(e)}),m.addEventListener("load",()=>{t(m)})})}))}(c.map(e=>"@default"===e?t:e)),e.fn.millerColumns=function(t){const c={current:e=>{},reset:e=>{},preview:e=>{},breadcrumb:a,animation:l,delay:500,resetOnOutsideClick:!0};return s=e.extend(c,t),this.each(function(){const t=e(this);!function(t){const c=[];let s;for(c.push(t.children());c.length;)(s=c.shift()).children(i).each(function(s,i){const o=e(this),a=o.children(r),l=o.parent().parent();l.length&&null==o.data(`${n}-ancestor`)&&e(this).siblings().addBack().data(`${n}-ancestor`,l),a.length&&(c.push(a),e(this).data(`${n}-child`,a).addClass(`${n}-parent`)),e(this).parent(r).appendTo(t).addClass(`${n}-column`)})}(t),d(),t.find(i).on("click",function(c){const r=e(this);h(t);const i=r.data(`${n}-child`);let o=r;for(i&&i.removeClass(`${n}-collapse`).children().removeClass(`${n}-selected`);o;)o.addClass(`${n}-selected`).parent().removeClass(`${n}-collapse`),o=o.data(`${n}-ancestor`);if(s.animation.call(this,r,t),s.breadcrumb.call(this),s.current.call(this,r,t),s.preview&&r.hasClass(`${n}-selected`)&&!r.hasClass(`${n}-parent`)){const e=s.preview.call(this,r,t);r.parent().parent().append(`<ul class="${n}-column ${n}-preview">\n                                <li>${e}</li>\n                            </ul>`)}c.stopPropagation()}),t.on("keydown",p(t)),t.on("click",()=>{s.resetOnOutsideClick&&f(t)})})}}});
