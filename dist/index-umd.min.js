!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).addMillerColumnPlugin=t()}(this,(function(){"use strict";var e="undefined"!=typeof document?document.currentScript:null;function t(e,{before:t,after:n,favicon:a,canvas:r,image:c=!0,acceptErrors:s}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map((e=>function(e){let i,o={};Array.isArray(e)?[i,o={}]=e:i=e;let{favicon:l=a}=o;const{before:d=t,after:u=n,canvas:f=r,image:h=c}=o;function p(){d?d.before(m):u?u.after(m):document.head.append(m)}const m=document.createElement("link");return new Promise(((e,t)=>{let n=t;if(s&&(n="function"==typeof s?n=>{s({error:n,stylesheetURL:i,options:o,resolve:e,reject:t})}:e),i.endsWith(".css")?l=!1:i.endsWith(".ico")&&(l=!0),l){if(m.rel="shortcut icon",m.type="image/x-icon",!1===h)return m.href=i,p(),void e(m);const n=document.createElement("canvas");n.width=16,n.height=16;const a=n.getContext("2d"),r=document.createElement("img");return r.addEventListener("error",(e=>{t(e)})),r.addEventListener("load",(()=>{if(!a)throw new Error("Canvas context could not be found");a.drawImage(r,0,0),m.href=f?n.toDataURL("image/x-icon"):i,p(),e(m)})),void(r.src=i)}m.rel="stylesheet",m.type="text/css",m.href=i,p(),m.addEventListener("error",(e=>{n(e)})),m.addEventListener("load",(()=>{e(m)}))}))}(e))))}
/**
   * MIT License.
   *
   * @copyright 2014 White Magic Software, Inc.
   * @copyright 2018 Brett Zamir
   */const n=new URL("../miller-columns.css","undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:e&&"SCRIPT"===e.tagName.toUpperCase()&&e.src||new URL("index-umd.min.js",document.baseURI).href).href;return async function(e,{namespace:a="miller",stylesheets:r=["@default"]}={}){let c;const s=`ul:not(.${a}-no-columns),ol:not(.${a}-no-columns)`,i="li";function o(){return e(`.${a}-column > .${a}-selected`)}function l(){const t=e(`.${a}-breadcrumbs`).empty();o().each((function(){const n=e(this);e(`<span class="${a}-breadcrumb">`).text(n.text().trim()).on("click",(function(){n.trigger("click")})).appendTo(t)}))}function d(t,n){let r=0;(t?o().not(t):o()).each((function(){r+=e(this).outerWidth(!0)})),n.stop().animate({scrollLeft:r},c.delay,(function(){n.find(`.${a}-column:not(.${a}-collapse)`).last()[0].scrollLeft=r,c.scroll&&c.scroll.call(this,t,n)}))}function u(t,n){const r=[];let c;for(r.push(n||t.children());r.length;)c=r.shift(),c.children(i).each((function(n,c){const o=e(this),l=o.children(s),d=o.parent().parent();d.length&&d.is(i)&&null==o.data(`${a}-ancestor`)&&e(this).siblings().addBack().data(`${a}-ancestor`,d),l.length&&(r.push(l),e(this).data(`${a}-child`,l).addClass(`${a}-parent`)),e(this).parent(s).appendTo(t).addClass(`${a}-column`)}))}function f(){e(`.${a}-column:gt(0)`).addClass(`${a}-collapse`)}function h(){return o().last()}function p(e){m(e),function(e){d(null,e)}(e)}function m(t){f(),o().removeClass(`${a}-selected`),l(),c.reset(t),c.preview&&e(`.${a}-preview`).remove()}function $(){h().next().trigger("click")}function g(t){let n,r="";return function(c){const s=c.key;let o=!1;switch(s){case"Escape":p(t);break;case"ArrowUp":h().prev().trigger("click"),o=!0;break;case"ArrowDown":$(),o=!0;break;case"ArrowLeft":!function(){const e=h(),t=e.data(`${a}-ancestor`),n=e.data(`${a}-child`);(!n||n.hasClass(`${a}-collapse`)||t)&&t&&t.trigger("click")}(),o=!0;break;case"ArrowRight":!function(){const e=h().data(`${a}-child`);e?e.children(i).first().trigger("click"):$()}(),o=!0;break;default:if(1===s.length){!function(e){const t=Date.now();!n||t-n<500?r+=e:r=e,n=t}(s);t.find(`${i}.${a}-selected`).last().siblings().filter((function(){return new RegExp("^"+(t=r,t.replaceAll(/[\-\[\]\{\}\(\)*+?.,\\^$\|#\s]/gv,String.raw`\$&`)),"iv").test(e(this).text().trim());var t})).first().trigger("click")}o=!0}o&&0===h().length&&e(`.${a}-column`).first().children().first().trigger("click"),o&&c.preventDefault()}}return r&&await t(r.map((e=>"@default"===e?n:e))),e.fn.millerColumns=function(t){const n={current(e){},reset(e){},preview:null,breadcrumb:l,animation:d,delay:500,resetOnOutsideClick:!0};c=e.extend(n,t);const r=this.each((function(){const t=e(this),n=t.html();t.data(`${a}-original-html`,n),u(t),f();const r=g(t);t.on("click",i,(function(n){const r=e(this);m(t);const s=r.data(`${a}-child`);let i=r;for(s&&s.removeClass(`${a}-collapse`).children().removeClass(`${a}-selected`);i;)i.addClass(`${a}-selected`).parent().removeClass(`${a}-collapse`),i=i.data(`${a}-ancestor`);if(c.animation.call(this,r,t),c.breadcrumb.call(this),c.current.call(this,r,t),c.preview){if(r.hasClass(`${a}-selected`)&&!r.hasClass(`${a}-parent`)){const e=c.preview.call(this,r,t);r.parent().parent().append(`<ul class="${a}-column ${a}-preview">\n                                <li>${e}</li>\n                            </ul>`)}}n.stopPropagation()})),t[0].addEventListener("keydown",r),t.on("click",(()=>{c.resetOnOutsideClick&&p(t)})),t.data(`${a}-keypress-handler`,r)}));return r.addItem=function(t,n){const c="string"==typeof t?e(t):t,i=r;if(n){let t=n.data(`${a}-child`);t?(t.append(c),c.data(`${a}-ancestor`,n)):(t=e("<ul>").append(c),n.append(t),n.data(`${a}-child`,t).addClass(`${a}-parent`),c.data(`${a}-ancestor`,n),u(i,t),t=n.data(`${a}-child`));const r=c.children(s);r.length&&(c.data(`${a}-child`,r).addClass(`${a}-parent`),u(i,r))}else{const t=i.find(`.${a}-column`).first();if(t.length){t.append(c);const e=c.children(s);e.length&&(c.data(`${a}-child`,e).addClass(`${a}-parent`),u(i,e))}else{const t=e("<ul>").append(c);i.append(t),u(i,t)}}return c},r.destroy=function(){return r.each((function(){const t=e(this),n=t.data(`${a}-keypress-handler`);n&&this.removeEventListener("keydown",n),t.off("click"),t.find(`.${a}-column`).removeClass(`${a}-column ${a}-collapse`),t.find(`.${a}-parent`).removeClass(`${a}-parent`),t.find(`.${a}-selected`).removeClass(`${a}-selected`),t.find("li").each((function(){const t=e(this);t.removeData(`${a}-ancestor`),t.removeData(`${a}-child`)})),t.find(`.${a}-preview`).remove();const r=t.data(`${a}-original-html`);r&&(t.html(r),t.removeData(`${a}-original-html`)),t.removeData(`${a}-keypress-handler`)})),delete r.addItem,delete r.destroy,r},r},e}}));
