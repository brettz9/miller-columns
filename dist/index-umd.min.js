!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).addMillerColumnPlugin=t()}(this,(function(){"use strict";function e(e,{before:t,after:n,favicon:c,canvas:s,image:r=!0,acceptErrors:i}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(e=>(function(e){let o={};Array.isArray(e)&&([e,o={}]=e);let{favicon:l=c}=o;const{before:a=t,after:d=n,canvas:u=s,image:f=r}=o;function h(){a?a.before(m):d?d.after(m):document.head.appendChild(m)}const m=document.createElement("link");return new Promise((t,n)=>{let c=n;if(i&&(c="function"==typeof i?c=>{i({error:c,stylesheetURL:e,options:o,resolve:t,reject:n})}:t),e.endsWith(".css")?l=!1:e.endsWith(".ico")&&(l=!0),l){if(m.rel="shortcut icon",m.type="image/x-icon",!1===f)return m.href=e,h(),void t(m);const c=document.createElement("canvas");c.width=16,c.height=16;const s=c.getContext("2d"),r=document.createElement("img");return r.addEventListener("error",e=>{n(e)}),r.addEventListener("load",()=>{s.drawImage(r,0,0),m.href=u?c.toDataURL("image/x-icon"):e,h(),t(m)}),void(r.src=e)}m.rel="stylesheet",m.type="text/css",m.href=e,h(),m.addEventListener("error",e=>{c(e)}),m.addEventListener("load",()=>{t(m)})})})(e)))}const t=new URL("node_modules/miller-columns/src/index.js",location),n=new URL("../miller-columns.css",t).href;return async function(t,{namespace:c="miller",stylesheets:s=["@default"]}={}){let r;const i=`ul:not(.${c}-no-columns),ol:not(.${c}-no-columns)`,o="li";function l(){return t(`.${c}-column > .${c}-selected`)}function a(){const e=t(`.${c}-breadcrumbs`).empty();l().each((function(){const n=t(this);t(`<span class="${c}-breadcrumb">`).text(n.text().trim()).click((function(){n.click()})).appendTo(e)}))}function d(e,n){let s=0;l().not(e).each((function(){s+=t(this).outerWidth(!0)})),n.stop().animate({scrollLeft:s},r.delay,(function(){n.find(`.${c}-column:not(.${c}-collapse)`).last()[0].scrollLeft=s,r.scroll&&r.scroll.call(this,e,n)}))}function u(){t(`.${c}-column:gt(0)`).addClass(`${c}-collapse`)}function f(){return l().last()}function h(e){m(e),function(e){d(null,e)}(e)}function m(e){u(),l().removeClass(`${c}-selected`),a(),r.reset(e),r.preview&&t(`.${c}-preview`).remove()}function p(){f().next().click()}function $(e){let n,s="";return function(r){const{key:i}=r;let l=!1;switch(i){case"Escape":h(e);break;case"ArrowUp":f().prev().click(),l=!0;break;case"ArrowDown":p(),l=!0;break;case"ArrowLeft":!function(){const e=f().data(`${c}-ancestor`);e&&e.click()}(),l=!0;break;case"ArrowRight":!function(){const e=f().data(`${c}-child`);e?e.children(o).first().click():p()}(),l=!0;break;default:if(1===i.length){!function(e){const t=new Date;!n||t-n<500?s+=e:s=e,n=t}(i),e.find(`${o}.${c}-selected`).last().siblings().filter((function(){return new RegExp("^"+(e=s,e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"i").test(t(this).text().trim());var e})).first().click()}l=!0}l&&0===f().length&&t(`.${c}-column`).first().children().first().click(),l&&r.preventDefault()}}return s&&await e(s.map(e=>"@default"===e?n:e)),t.fn.millerColumns=function(e){const n={current(e){},reset(e){},preview:null,breadcrumb:a,animation:d,delay:500,resetOnOutsideClick:!0};return r=t.extend(n,e),this.each((function(){const e=t(this);!function(e){const n=[];let s;for(n.push(e.children());n.length;)s=n.shift(),s.children(o).each((function(s,r){const o=t(this),l=o.children(i),a=o.parent().parent();a.length&&null==o.data(`${c}-ancestor`)&&t(this).siblings().addBack().data(`${c}-ancestor`,a),l.length&&(n.push(l),t(this).data(`${c}-child`,l).addClass(`${c}-parent`)),t(this).parent(i).appendTo(e).addClass(`${c}-column`)}))}(e),u(),e.find(o).on("click",(function(n){const s=t(this);m(e);const i=s.data(`${c}-child`);let o=s;for(i&&i.removeClass(`${c}-collapse`).children().removeClass(`${c}-selected`);o;)o.addClass(`${c}-selected`).parent().removeClass(`${c}-collapse`),o=o.data(`${c}-ancestor`);if(r.animation.call(this,s,e),r.breadcrumb.call(this),r.current.call(this,s,e),r.preview){if(s.hasClass(`${c}-selected`)&&!s.hasClass(`${c}-parent`)){const t=r.preview.call(this,s,e);s.parent().parent().append(`<ul class="${c}-column ${c}-preview">\n                                <li>${t}</li>\n                            </ul>`)}}n.stopPropagation()})),e.on("keydown",$(e)),e.on("click",()=>{r.resetOnOutsideClick&&h(e)})}))},t}}));
