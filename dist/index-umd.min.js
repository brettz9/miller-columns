!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.addMillerColumnPlugin=n()}(this,function(){"use strict";const e=new URL("node_modules/miller-columns/src/index.js",location),n=new URL("../miller-columns.css",e).href;return async function(e,{namespace:t="miller",stylesheets:c=["@default"]}={}){let o;const i=`ul:not(.${t}-no-columns),ol:not(.${t}-no-columns)`,l="li";function s(){return e(`.${t}-column > .${t}-selected`)}function r(){const n=e(`.${t}-breadcrumbs`).empty();s().each(function(){const c=e(this);e(`<span class="${t}-breadcrumb">`).text(c.text().trim()).click(function(){c.click()}).appendTo(n)})}function a(n,t){let c=0;s().not(n).each(function(){c+=e(this).outerWidth(!0)}),t.stop().animate({scrollLeft:c},o.delay)}function d(){e(`.${t}-column:gt(0)`).addClass(`${t}-collapse`)}function u(){return s().last()}function f(e){h(e),function(e){a(null,e)}(e)}function h(e){d(),s().removeClass(`${t}-selected`),r(),o.current(null,e)}function m(){u().next().click()}function p(n){let c,o="";return function(i){const{key:s}=i;let r=!1;switch(s){case"Escape":f(n);break;case"ArrowUp":u().prev().click(),r=!0;break;case"ArrowDown":m(),r=!0;break;case"ArrowLeft":!function(){const e=u().data(`${t}-ancestor`);e&&e.click()}(),r=!0;break;case"ArrowRight":!function(){const e=u().data(`${t}-child`);e?e.children(l).first().click():m()}(),r=!0;break;default:1===s.length&&(!function(e){const n=new Date;!c||n-c<500?o+=e:o=e,c=n}(s),n.find(`ul:not(.${t}-no-columns,.${t}-collapse),\n                        ol:not(.${t}-no-columns,.${t}-collapse) > li.${t}-selected`).last().parent().children().children(`*:not(ul:not(.${t}-no-columns))`).filter(function(){return new RegExp("^"+(n=o,n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"i").test(e(this).text().trim());var n}).first().click()),r=!0}r&&0===u().length&&e(`.${t}-column`).first().children().first().click(),r&&i.preventDefault()}}c&&await function(e,{before:n,after:t,favicon:c,canvas:o,image:i=!0}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(function(e){function l(){n?n.before(s):t?t.after(s):document.head.appendChild(s)}const s=document.createElement("link");return new Promise((n,t)=>{if(e.endsWith(".ico")&&(c=!0),c){if(s.rel="shortcut icon",s.type="image/x-icon",!1===i)return s.href=e,l(),void n(s);const c=document.createElement("canvas");c.width=16,c.height=16;const r=c.getContext("2d"),a=document.createElement("img");return a.addEventListener("error",e=>{t(e)}),a.addEventListener("load",()=>{r.drawImage(a,0,0),s.href=o?c.toDataURL("image/x-icon"):e,l(),n(s)}),void(a.src=e)}s.rel="stylesheet",s.type="text/css",s.href=e,l(),s.addEventListener("error",e=>{t(e)}),s.addEventListener("load",()=>{n(s)})})}))}(c.map(e=>"@default"===e?n:e)),e.fn.millerColumns=function(n){const c={current:e=>{},breadcrumb:r,animation:a,delay:500,resetOnOutsideClick:!0};return o=e.extend(c,n),this.each(function(){const n=e(this);!function(n){const c=[];let o;for(c.push(n.children());c.length;)(o=c.shift()).children(l).each(function(o,l){const s=e(this),r=s.children(i),a=s.parent().parent();a.length&&null==s.data(`${t}-ancestor`)&&e(this).siblings().addBack().data(`${t}-ancestor`,a),r.length&&(c.push(r),e(this).data(`${t}-child`,r).addClass(`${t}-parent`)),e(this).parent(i).appendTo(n).addClass(`${t}-column`)})}(n),d(),n.find(l).on("click",function(c){const i=e(this);h(n);const l=i.data(`${t}-child`);let s=i;for(l&&l.removeClass(`${t}-collapse`).children().removeClass(`${t}-selected`);s;)s.addClass(`${t}-selected`).parent().removeClass(`${t}-collapse`),s=s.data(`${t}-ancestor`);o.animation.call(this,i,n),o.breadcrumb.call(this),o.current.call(this,i,n),c.stopPropagation()}),n.on("keydown",p(n)),n.on("click",()=>{o.resetOnOutsideClick&&f(n)})})}}});
