!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).addMillerColumnPlugin=t()}(this,(function(){"use strict";function e(e,{before:t,after:n,favicon:c,canvas:r,image:s=!0,acceptErrors:o}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map((e=>function(e){let i,l={};Array.isArray(e)?[i,l={}]=e:i=e;let{favicon:a=c}=l;const{before:d=t,after:u=n,canvas:f=r,image:h=s}=l;function p(){d?d.before(m):u?u.after(m):document.head.append(m)}const m=document.createElement("link");return new Promise(((e,t)=>{let n=t;if(o&&(n="function"==typeof o?n=>{o({error:n,stylesheetURL:i,options:l,resolve:e,reject:t})}:e),i.endsWith(".css")?a=!1:i.endsWith(".ico")&&(a=!0),a){if(m.rel="shortcut icon",m.type="image/x-icon",!1===h)return m.href=i,p(),void e(m);const n=document.createElement("canvas");n.width=16,n.height=16;const c=n.getContext("2d"),r=document.createElement("img");return r.addEventListener("error",(e=>{t(e)})),r.addEventListener("load",(()=>{if(!c)throw new Error("Canvas context could not be found");c.drawImage(r,0,0),m.href=f?n.toDataURL("image/x-icon"):i,p(),e(m)})),void(r.src=i)}m.rel="stylesheet",m.type="text/css",m.href=i,p(),m.addEventListener("error",(e=>{n(e)})),m.addEventListener("load",(()=>{e(m)}))}))}(e))))}
/**
   * MIT License.
   *
   * @copyright 2014 White Magic Software, Inc.
   * @copyright 2018 Brett Zamir
   */const t=new URL("../miller-columns.css",void 0).href;return async function(n,{namespace:c="miller",stylesheets:r=["@default"]}={}){let s;const o=`ul:not(.${c}-no-columns),ol:not(.${c}-no-columns)`,i="li";function l(){return n(`.${c}-column > .${c}-selected`)}function a(){const e=n(`.${c}-breadcrumbs`).empty();l().each((function(){const t=n(this);n(`<span class="${c}-breadcrumb">`).text(t.text().trim()).click((function(){t.click()})).appendTo(e)}))}function d(e,t){let r=0;(e?l().not(e):l()).each((function(){r+=n(this).outerWidth(!0)})),t.stop().animate({scrollLeft:r},s.delay,(function(){t.find(`.${c}-column:not(.${c}-collapse)`).last()[0].scrollLeft=r,s.scroll&&s.scroll.call(this,e,t)}))}function u(){n(`.${c}-column:gt(0)`).addClass(`${c}-collapse`)}function f(){return l().last()}function h(e){p(e),function(e){d(null,e)}(e)}function p(e){u(),l().removeClass(`${c}-selected`),a(),s.reset(e),s.preview&&n(`.${c}-preview`).remove()}function m(){f().next().click()}function $(e){let t,r="";return function(s){const o=s.key;let l=!1;switch(o){case"Escape":h(e);break;case"ArrowUp":f().prev().click(),l=!0;break;case"ArrowDown":m(),l=!0;break;case"ArrowLeft":!function(){const e=f().data(`${c}-ancestor`);e&&e.click()}(),l=!0;break;case"ArrowRight":!function(){const e=f().data(`${c}-child`);e?e.children(i).first().click():m()}(),l=!0;break;default:if(1===o.length){!function(e){const n=Date.now();!t||n-t<500?r+=e:r=e,t=n}(o);e.find(`${i}.${c}-selected`).last().siblings().filter((function(){return new RegExp("^"+(e=r,e.replaceAll(/[\-\[\]\{\}\(\)*+?.,\\^$\|#\s]/gv,String.raw`\$&`)),"iv").test(n(this).text().trim());var e})).first().click()}l=!0}l&&0===f().length&&n(`.${c}-column`).first().children().first().click(),l&&s.preventDefault()}}return r&&await e(r.map((e=>"@default"===e?t:e))),n.fn.millerColumns=function(e){const t={current(e){},reset(e){},preview:null,breadcrumb:a,animation:d,delay:500,resetOnOutsideClick:!0};return s=n.extend(t,e),this.each((function(){const e=n(this);!function(e){const t=[];let r;for(t.push(e.children());t.length;)r=t.shift(),r.children(i).each((function(r,s){const i=n(this),l=i.children(o),a=i.parent().parent();a.length&&null==i.data(`${c}-ancestor`)&&n(this).siblings().addBack().data(`${c}-ancestor`,a),l.length&&(t.push(l),n(this).data(`${c}-child`,l).addClass(`${c}-parent`)),n(this).parent(o).appendTo(e).addClass(`${c}-column`)}))}(e),u(),e.find(i).on("click",(function(t){const r=n(this);p(e);const o=r.data(`${c}-child`);let i=r;for(o&&o.removeClass(`${c}-collapse`).children().removeClass(`${c}-selected`);i;)i.addClass(`${c}-selected`).parent().removeClass(`${c}-collapse`),i=i.data(`${c}-ancestor`);if(s.animation.call(this,r,e),s.breadcrumb.call(this),s.current.call(this,r,e),s.preview){if(r.hasClass(`${c}-selected`)&&!r.hasClass(`${c}-parent`)){const t=s.preview.call(this,r,e);r.parent().parent().append(`<ul class="${c}-column ${c}-preview">\n                                <li>${t}</li>\n                            </ul>`)}}t.stopPropagation()})),e.on("keydown",$(e)),e.on("click",(()=>{s.resetOnOutsideClick&&h(e)}))}))},n}}));
