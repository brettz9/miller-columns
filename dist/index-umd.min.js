!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.MillerColumns=n()}(this,function(){"use strict";return function(t){let n;const e="ul",c="li";function i(){return t(".column > .selected")}function s(){const n=t("div.breadcrumb").empty();i().each(function(){const e=t(this);t("<span>").text(e.text().trim()).click(function(){e.click()}).appendTo(n)})}function l(e,c){let s=0;i().not(e).each(function(){s+=t(this).outerWidth(!0)}),c.stop().animate({scrollLeft:s},n.delay)}function o(){t(".column:gt(0)").addClass("collapse")}function a(){return i().last()}function r(t){o(),i().removeClass("selected"),s(),n.current(null,t)}function u(){a().next().click()}function d(n){return function(e){let i=!1;switch(e.which){case 27:r(n);break;case 38:a().prev().click(),i=!0;break;case 40:u(),i=!0;break;case 37:!function(){const t=a().data("ancestor");t&&t.click()}(),i=!0;break;case 39:!function(){const t=a().data("child");t?t.children(c).first().click():u()}(),i=!0}i&&0===a().length&&t(".column").first().children().first().click(),i&&e.preventDefault()}}t.fn.millerColumns=function(i){const a={current:t=>{},breadcrumb:s,animation:l,delay:500,resetOnOutsideClick:!0};return n=t.extend(a,i),this.each(function(){const i=t(this);!function(n){const i=[];let s;for(i.push(n.children());i.length;)(s=i.shift()).children(c).each(function(c,s){const l=t(this),o=l.children(e),a=l.parent().parent();a.length&&null==l.data("ancestor")&&t(this).siblings().addBack().data("ancestor",a),o.length&&(i.push(o),t(this).data("child",o).addClass("parent")),t(this).parent(e).appendTo(n).addClass("column")})}(i),o(),i.find(c).on("click",function(e){const c=t(this);r(i);const s=c.data("child");let l=c;for(s&&s.removeClass("collapse").children().removeClass("selected");l;)l.addClass("selected").parent().removeClass("collapse"),l=l.data("ancestor");n.animation.call(this,c,i),n.breadcrumb.call(this),n.current.call(this,c,i),e.stopPropagation()}),i.on("keydown",d(i)),i.on("click",()=>{n.resetOnOutsideClick&&r(i)})})}}});
