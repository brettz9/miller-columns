function e(e,{before:t,after:n,favicon:c,canvas:s,image:r=!0,acceptErrors:a}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(e=>(function(e){let l={};Array.isArray(e)&&([e,l={}]=e);let{favicon:i=c}=l;const{before:o=t,after:d=n,canvas:u=s,image:f=r}=l;function h(){o?o.before(m):d?d.after(m):document.head.appendChild(m)}const m=document.createElement("link");return new Promise((t,n)=>{let c=n;if(a&&(c="function"==typeof a?c=>{a({error:c,stylesheetURL:e,options:l,resolve:t,reject:n})}:t),e.endsWith(".css")?i=!1:e.endsWith(".ico")&&(i=!0),i){if(m.rel="shortcut icon",m.type="image/x-icon",!1===f)return m.href=e,h(),void t(m);const c=document.createElement("canvas");c.width=16,c.height=16;const s=c.getContext("2d"),r=document.createElement("img");return r.addEventListener("error",e=>{n(e)}),r.addEventListener("load",()=>{s.drawImage(r,0,0),m.href=u?c.toDataURL("image/x-icon"):e,h(),t(m)}),void(r.src=e)}m.rel="stylesheet",m.type="text/css",m.href=e,h(),m.addEventListener("error",e=>{c(e)}),m.addEventListener("load",()=>{t(m)})})})(e)))}const t=new URL("node_modules/miller-columns/src/index.js",location),n=new URL("../miller-columns.css",t).href;export default async function(t,{namespace:c="miller",stylesheets:s=["@default"]}={}){let r;const a=`ul:not(.${c}-no-columns),ol:not(.${c}-no-columns)`,l="li";function i(){return t(`.${c}-column > .${c}-selected`)}function o(){const e=t(`.${c}-breadcrumbs`).empty();i().each((function(){const n=t(this);t(`<span class="${c}-breadcrumb">`).text(n.text().trim()).click((function(){n.click()})).appendTo(e)}))}function d(e,n){let s=0;i().not(e).each((function(){s+=t(this).outerWidth(!0)})),n.stop().animate({scrollLeft:s},r.delay,(function(){n.find(`.${c}-column:not(.${c}-collapse)`).last()[0].scrollLeft=s,r.scroll&&r.scroll.call(this,e,n)}))}function u(){t(`.${c}-column:gt(0)`).addClass(`${c}-collapse`)}function f(){return i().last()}function h(e){m(e),function(e){d(null,e)}(e)}function m(e){u(),i().removeClass(`${c}-selected`),o(),r.reset(e),r.preview&&t(`.${c}-preview`).remove()}function p(){f().next().click()}function $(e){let n,s="";return function(r){const{key:a}=r;let i=!1;switch(a){case"Escape":h(e);break;case"ArrowUp":f().prev().click(),i=!0;break;case"ArrowDown":p(),i=!0;break;case"ArrowLeft":!function(){const e=f().data(`${c}-ancestor`);e&&e.click()}(),i=!0;break;case"ArrowRight":!function(){const e=f().data(`${c}-child`);e?e.children(l).first().click():p()}(),i=!0;break;default:if(1===a.length){!function(e){const t=new Date;!n||t-n<500?s+=e:s=e,n=t}(a),e.find(`${l}.${c}-selected`).last().siblings().filter((function(){return new RegExp("^"+(e=s,e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"i").test(t(this).text().trim());var e})).first().click()}i=!0}i&&0===f().length&&t(`.${c}-column`).first().children().first().click(),i&&r.preventDefault()}}return s&&await e(s.map(e=>"@default"===e?n:e)),t.fn.millerColumns=function(e){const n={current(e){},reset(e){},preview:null,breadcrumb:o,animation:d,delay:500,resetOnOutsideClick:!0};return r=t.extend(n,e),this.each((function(){const e=t(this);!function(e){const n=[];let s;for(n.push(e.children());n.length;)(s=n.shift()).children(l).each((function(s,r){const l=t(this),i=l.children(a),o=l.parent().parent();o.length&&null==l.data(`${c}-ancestor`)&&t(this).siblings().addBack().data(`${c}-ancestor`,o),i.length&&(n.push(i),t(this).data(`${c}-child`,i).addClass(`${c}-parent`)),t(this).parent(a).appendTo(e).addClass(`${c}-column`)}))}(e),u(),e.find(l).on("click",(function(n){const s=t(this);m(e);const a=s.data(`${c}-child`);let l=s;for(a&&a.removeClass(`${c}-collapse`).children().removeClass(`${c}-selected`);l;)l.addClass(`${c}-selected`).parent().removeClass(`${c}-collapse`),l=l.data(`${c}-ancestor`);if(r.animation.call(this,s,e),r.breadcrumb.call(this),r.current.call(this,s,e),r.preview){if(s.hasClass(`${c}-selected`)&&!s.hasClass(`${c}-parent`)){const t=r.preview.call(this,s,e);s.parent().parent().append(`<ul class="${c}-column ${c}-preview">\n                                <li>${t}</li>\n                            </ul>`)}}n.stopPropagation()})),e.on("keydown",$(e)),e.on("click",()=>{r.resetOnOutsideClick&&h(e)})}))},t}
