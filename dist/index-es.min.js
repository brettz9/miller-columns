function e(e,{before:t,after:n,favicon:c,canvas:s,image:r=!0,acceptErrors:l}={}){return e=Array.isArray(e)?e:[e],Promise.all(e.map(e=>function(e){let i={};Array.isArray(e)&&([e,i={}]=e);let{favicon:a=c}=i;const{before:o=t,after:d=n,canvas:u=s,image:f=r}=i;function h(){o?o.before(m):d?d.after(m):document.head.appendChild(m)}const m=document.createElement("link");return new Promise((t,n)=>{let c=n;if(l&&(c="function"==typeof l?c=>{l({error:c,stylesheetURL:e,options:i,resolve:t,reject:n})}:t),e.endsWith(".css")?a=!1:e.endsWith(".ico")&&(a=!0),a){if(m.rel="shortcut icon",m.type="image/x-icon",!1===f)return m.href=e,h(),void t(m);const c=document.createElement("canvas");c.width=16,c.height=16;const s=c.getContext("2d"),r=document.createElement("img");return r.addEventListener("error",e=>{n(e)}),r.addEventListener("load",()=>{s.drawImage(r,0,0),m.href=u?c.toDataURL("image/x-icon"):e,h(),t(m)}),void(r.src=e)}m.rel="stylesheet",m.type="text/css",m.href=e,h(),m.addEventListener("error",e=>{c(e)}),m.addEventListener("load",()=>{t(m)})})}(e)))}const t=new URL("node_modules/miller-columns/src/index.js",location),n=new URL("../miller-columns.css",t).href;export default async function(t,{namespace:c="miller",stylesheets:s=["@default"]}={}){let r;const l=`ul:not(.${c}-no-columns),ol:not(.${c}-no-columns)`;function i(){return t(`.${c}-column > .${c}-selected`)}function a(){const e=t(`.${c}-breadcrumbs`).empty();i().each((function(){const n=t(this);t(`<span class="${c}-breadcrumb">`).text(n.text().trim()).click((function(){n.click()})).appendTo(e)}))}function o(e,n){let s=0;i().not(e).each((function(){s+=t(this).outerWidth(!0)})),n.stop().animate({scrollLeft:s},r.delay,(function(){n.find(`.${c}-column:not(.${c}-collapse)`).last()[0].scrollLeft=s,r.scroll&&r.scroll.call(this,e,n)}))}function d(){t(`.${c}-column:gt(0)`).addClass(c+"-collapse")}function u(){return i().last()}function f(e){h(e),function(e){o(null,e)}(e)}function h(e){d(),i().removeClass(c+"-selected"),a(),r.reset(e),r.preview&&t(`.${c}-preview`).remove()}function m(){u().next().click()}function p(e){let n,s="";return function(r){const{key:l}=r;let i=!1;switch(l){case"Escape":f(e);break;case"ArrowUp":u().prev().click(),i=!0;break;case"ArrowDown":m(),i=!0;break;case"ArrowLeft":!function(){const e=u().data(c+"-ancestor");e&&e.click()}(),i=!0;break;case"ArrowRight":!function(){const e=u().data(c+"-child");e?e.children("li").first().click():m()}(),i=!0;break;default:if(1===l.length){!function(e){const t=new Date;!n||t-n<500?s+=e:s=e,n=t}(l);e.find(`li.${c}-selected`).last().siblings().filter((function(){return new RegExp("^"+(e=s,e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"i").test(t(this).text().trim());var e})).first().click()}i=!0}i&&0===u().length&&t(`.${c}-column`).first().children().first().click(),i&&r.preventDefault()}}return s&&await e(s.map(e=>"@default"===e?n:e)),t.fn.millerColumns=function(e){const n={current(e){},reset(e){},preview:null,breadcrumb:a,animation:o,delay:500,resetOnOutsideClick:!0};return r=t.extend(n,e),this.each((function(){const e=t(this);!function(e){const n=[];let s;for(n.push(e.children());n.length;)s=n.shift(),s.children("li").each((function(s,r){const i=t(this),a=i.children(l),o=i.parent().parent();o.length&&null==i.data(c+"-ancestor")&&t(this).siblings().addBack().data(c+"-ancestor",o),a.length&&(n.push(a),t(this).data(c+"-child",a).addClass(c+"-parent")),t(this).parent(l).appendTo(e).addClass(c+"-column")}))}(e),d(),e.find("li").on("click",(function(n){const s=t(this);h(e);const l=s.data(c+"-child");let i=s;for(l&&l.removeClass(c+"-collapse").children().removeClass(c+"-selected");i;)i.addClass(c+"-selected").parent().removeClass(c+"-collapse"),i=i.data(c+"-ancestor");if(r.animation.call(this,s,e),r.breadcrumb.call(this),r.current.call(this,s,e),r.preview){if(s.hasClass(c+"-selected")&&!s.hasClass(c+"-parent")){const t=r.preview.call(this,s,e);s.parent().parent().append(`<ul class="${c}-column ${c}-preview">\n                                <li>${t}</li>\n                            </ul>`)}}n.stopPropagation()})),e.on("keydown",p(e)),e.on("click",()=>{r.resetOnOutsideClick&&f(e)})}))},t}
